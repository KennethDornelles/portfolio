generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
  binaryTargets   = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [postgis, uuidOssp(map: "uuid-ossp")]
}

enum UserRole {
  ADMIN
  USER
  CONSULTANT
  CLIENT
}

enum LanguageCode {
  PT_BR
  EN_US
}

model User {
  id            String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email         String         @unique
  passwordHash  String
  role          UserRole       @default(USER)
  isActive      Boolean        @default(true)
  deletedAt     DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  refreshTokens RefreshToken[]
  auditLogs     AuditLog[]
  profile       Profile?

  @@index([role, isActive])
  @@index([deletedAt])
  @@map("users")
}

model RefreshToken {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  token       String   @unique
  userId      String   @db.Uuid
  ipAddress   String?
  userAgent   String?
  expiresAt   DateTime
  revokedAt   DateTime?
  createdAt   DateTime @default(now())
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("refresh_tokens")
}

model TranslationKey {
  id           String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  key          String        @unique
  description  String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  
  translations Translation[]

  @@map("translation_keys")
}

model Translation {
  id        String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  keyId     String       @db.Uuid
  language  LanguageCode
  value     String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  
  translationKey TranslationKey @relation(fields: [keyId], references: [id], onDelete: Cascade)

  @@unique([keyId, language])
  @@map("translations")
}

model AuditLog {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId      String?  @db.Uuid
  action      String
  entity      String
  entityId    String?
  ipAddress   String?
  userAgent   String?
  metadata    Json?
  createdAt   DateTime @default(now())
  
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([entity, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

model Store {
  id       String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name     String
  location Unsupported("geometry(Point, 4326)")?

  @@index([location], name: "location_idx", type: Gist)
  @@map("stores")
}

model Project {
  id            String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  title         String
  slug          String       @unique
  description   String
  content       String?      @db.Text
  thumbnail     String?
  repositoryUrl String?
  liveUrl       String?
  isActive      Boolean      @default(true)
  startDate     DateTime?
  endDate       DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  technologies  Technology[]

  @@map("projects")
}

model Technology {
  id        String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name      String    @unique
  icon      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  projects  Project[]

  @@map("technologies")
}

model Contact {
  id        String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name      String
  email     String
  message   String    @db.Text
  readAt    DateTime?
  createdAt DateTime  @default(now())

  @@map("contacts")
}

model Profile {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId      String   @unique @db.Uuid
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  bio         String?  @db.Text
  title       String?
  avatarUrl   String?
  socialLinks Json?    @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("profiles")
}